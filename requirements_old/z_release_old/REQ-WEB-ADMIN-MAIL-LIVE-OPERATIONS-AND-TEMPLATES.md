---
id: REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES
title: Replace admin mail placeholders with live mail operations and template catalog
status: released
implementation_scope: frontend
source: user-2026-02-11-admin-area-and-legacy-review
---

# Summary
Replace static admin mail placeholders with live mail operations and template catalog behavior for `/{locale}/app/admin/mail` and `/{locale}/app/admin/mail/templates`.

# Scope
- Frontend-only implementation in `web/` for admin mail screens.
- Routes and components:
  - `/{locale}/app/admin/mail`
  - `/{locale}/app/admin/mail/templates`
  - `web/src/components/admin/admin-mail-page.tsx`
  - `web/src/components/admin/admin-mail-templates-page.tsx`
- Adapter-backed mail operations and catalog loading:
  - `apiAdapters.admin.fetchMailStats`
  - `apiAdapters.admin.resetMailStats`
  - `apiAdapters.admin.sendTestMail`
  - `apiAdapters.admin.fetchMailTemplates`

# Acceptance Criteria
- Mail stats screen renders live stats from adapter/API payload; static KPI placeholders are removed.
- Test-mail action dispatches through adapter with explicit target email input and visible success/error feedback.
- Reset-mail-stats action uses explicit confirmation constraints before dispatch and surfaces operational-safety messaging.
- Mail templates screen renders live template catalog data from API and handles optional metadata fields safely.
- Both routes implement explicit `loading`, `empty`, `error`, and ready states.
- Recoverable failures provide a deterministic retry path without collapsing the full page.
- Missing/expired session or unauthorized responses follow localized admin auth/session guard behavior.
- Productive user-facing copy remains message-driven/localized with no hardcoded production strings.

# Definition of Done
- `web/src/components/admin/admin-mail-page.tsx` and `web/src/components/admin/admin-mail-templates-page.tsx` are API-backed through admin adapters.
- Operational actions (`test`, `reset`) are functional and include explicit guard/confirmation feedback.
- QA evidence includes: one happy path for stats + test-mail flow, one guarded reset/error path, and one template-catalog load path.
- Route behavior remains locale-prefixed and admin-role guarded.

# Assumptions
- Existing admin mail endpoints remain available with current adapter contract behavior.
- Template catalog endpoint is read-only in this requirement and may return variable metadata per template.
- Audit events for test send and stats reset are generated by backend/admin services.

# Constraints
- Keep admin route isolation under `/{locale}/app/admin...` and do not expose mail operations outside admin route space.
- Preserve mail module responsibilities from admin governance: stats, test send, reset controls, template navigation.
- Keep mail template route read-only in this requirement (catalog visibility only; no template editing/versioning workflow).
- Use adapter layer and centralized API error mapping only; no direct domain transport calls in screen components.
- Keep locale-prefixed routing and protected-route auth behavior unchanged.
- Keep implementation in `web/` only as the active frontend track.

# Out of Scope
- Backend mail engine changes.
- Admin mail-template editing/versioning workflow beyond catalog display.
- New admin mail backend endpoints or schema changes.
- Cross-module admin feature changes outside mail screens.

# References
- `docs/web-admin-governance-flow.md`
- `docs/api-reference.md`
- `docs/web-api-adapter-contract.md`
- `docs/web-auth-flows.md`
- `docs/web-governance.md`
- `docs/web-product-structure.md`
- `docs/web-quality-test-program.md`

# PO Results
- Decision: No direct contradiction with current docs; requirement is ready for architecture handoff.
- Decision: `implementation_scope` remains `frontend` in split mode because required mail endpoints and adapter contracts are already documented.
- Decision: Requirement scope is constrained to live mail operations and catalog visibility with documented guardrails.
- Changes: `/home/sebas/git/agents/requirements/selected/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`, `/home/sebas/git/agents/requirements/arch/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# Architecture Notes
- Keep mail operations isolated to admin route space only (`/{locale}/app/admin/mail` and `/{locale}/app/admin/mail/templates`) under existing admin guards.
- Use admin adapter methods only for data/actions (`fetchMailStats`, `sendTestMail`, `resetMailStats`, `fetchMailTemplates`) and centralized error classification.
- Enforce operational safeguards on reset action with explicit confirmation before dispatch; keep test-send action scoped to explicit target input.
- Keep templates route read-only in this requirement and tolerate optional template metadata fields without runtime failure.
- Preserve deterministic state handling (`loading`, `ready`, `empty`, `error`) and retry behavior while keeping message-driven copy and locale-prefixed routing.

# Dev Plan
1. Replace static placeholder content in `web/src/components/admin/admin-mail-page.tsx` and `web/src/components/admin/admin-mail-templates-page.tsx` with adapter-backed load flows.
2. Implement deterministic mail-stats mapping and explicit ready/empty/error presentation for stats and timeline sections.
3. Wire test-mail action with explicit target email input, per-action pending state, and clear success/error feedback.
4. Wire reset-mail-stats action with explicit confirmation gate and operational-safety messaging before mutation dispatch.
5. Implement template catalog rendering from live payload with safe handling for missing optional metadata fields.
6. Verify unauthorized or expired-session behavior remains aligned with localized admin auth-guard redirects for both routes.
7. Capture QA evidence for happy path (stats + test), guarded reset/error path, and template-catalog load path.

# Architecture Results
- Decision: Requirement is architecture-ready and aligned with admin governance, API/adapters, auth guards, and scope boundaries.
- Decision: `implementation_scope: frontend` remains correct because required admin mail endpoints and adapter methods are already documented.
- Decision: Added architecture guardrails for reset confirmation flow and read-only template-catalog behavior.
- Changes: `/home/sebas/git/agents/requirements/arch/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md` -> `/home/sebas/git/agents/requirements/dev/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# Dev Results
- Replaced placeholder admin mail screen with live adapter-backed stats loading (`fetchMailStats`) including explicit `loading`, `empty`, `error`, and ready states with retry and localized unauthorized-session redirect handling.
- Implemented operational actions on admin mail screen: guarded test-mail send (`sendTestMail`) with explicit target email input and success/error feedback, plus reset stats (`resetMailStats`) with explicit typed confirmation + checkbox constraints before dispatch.
- Added live runtime context blocks for provider distribution and daily mail summary derived from API payload with deterministic ordering and safe optional-field parsing.
- Replaced placeholder admin mail-templates screen with live read-only catalog loading (`fetchMailTemplates`) including deterministic ordering, optional metadata fallbacks, and explicit `loading`, `empty`, `error`, and ready states with retry.
- Expanded admin mail adapter DTO typing for mail stats, template catalog entries, and action responses to support the live frontend mapping safely.
- Updated localized message namespaces (`de`/`en`) for both admin mail screens so all productive copy is message-driven.
- Validation: `npm --prefix web run lint` passed; `npm --prefix web run build` completed with pre-existing unrelated `MISSING_MESSAGE` logs in organization modules.
Changes: `web/src/components/admin/admin-mail-page.tsx`, `web/src/components/admin/admin-mail-templates-page.tsx`, `web/src/lib/api/adapters/admin.ts`, `web/messages/en.json`, `web/messages/de.json`, `/home/sebas/git/agents/requirements/qa/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# QA Results
- Decision: pass.
- Validation:
- Mail stats screen is live adapter-backed (`fetchMailStats`) and static KPI placeholders are removed.
- Test-mail action is adapter-dispatched (`sendTestMail`) with explicit target email input plus deterministic success/error feedback.
- Reset-mail-stats action enforces explicit confirmation constraints (typed token + checkbox) before dispatch and keeps operational-safety messaging visible.
- Mail templates route is live read-only catalog rendering (`fetchMailTemplates`) with safe optional metadata handling and deterministic sorting.
- Both routes implement explicit `loading`, `empty`, `error`, and ready states.
- Recoverable failures provide deterministic retry paths (`retryLoad`) without collapsing overall page structure.
- Unauthorized/expired session handling uses localized admin guard redirect flow (`clearSessionAndRedirectToLogin`).
- Productive copy remains localized/message-driven (`app.adminMail.*`, `app.adminMailTemplates.*`) with adapter-only transport usage (no direct `fetch`).
- Mandatory checks:
- `npm --prefix /home/sebas/git/shift-matching/web run lint` passed.
- `npm --prefix /home/sebas/git/shift-matching/web run build` passed (pre-existing non-blocking EN `MISSING_MESSAGE` logs remain in unrelated organization namespaces).
- `npm --prefix /home/sebas/git/shift-matching/app run build` passed.
- `npm --prefix /home/sebas/git/shift-matching/app run test` passed (`248` passed, `0` failed).
- QA evidence:
- Happy path: stats load + test-mail send flow works with post-action refresh and success notice.
- Guarded reset/error path: reset is blocked without explicit confirmation and surfaces deterministic error notice.
- Template-catalog load path: templates route loads live catalog with read-only presentation and safe metadata fallbacks.
- Changes: `/home/sebas/git/agents/requirements/sec/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# Security Results
- Decision: pass.
- Validation:
- Security review confirmed frontend admin-mail routes keep adapter-only transport usage, locale-prefixed route isolation, and localized unauthorized-session redirect behavior.
- Fixed requirement-scoped backend security/compliance gaps for admin mail mutations:
- `POST /admin/mail/test` now requires `adminId` context, rejects missing admin identity with `401`, and enforces deterministic non-empty email validation before service dispatch.
- `AdminMailService.sendTestEmail` now normalizes and validates target emails and emits `AUDIT_MAIL_TEST_SENT` with `adminId`, `targetEmail`, `template`, and timestamp.
- `POST /admin/mail/stats/reset` now requires `adminId` context and emits `AUDIT_MAIL_STATS_RESET` with `adminId`, deleted-counter context, and timestamp.
- Added focused regression tests for controller and service audit/validation behavior.
- Mandatory checks:
- `node --test --require ts-node/register src/admin/admin-mail.controller.test.ts src/admin/admin-mail.service.test.ts` passed.
- `npm --prefix /home/sebas/git/shift-matching/app run build` passed.
- `npm --prefix /home/sebas/git/shift-matching/app run test` passed (`259` passed, `0` failed).
Changes: `app/src/admin/admin-mail.controller.ts`, `app/src/admin/admin-mail.service.ts`, `app/src/admin/admin-mail.controller.test.ts`, `app/src/admin/admin-mail.service.test.ts`, `/home/sebas/git/agents/requirements/ux/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# UX Results
- Decision: pass.
- Validation:
- Reviewed `web/src/components/admin/admin-mail-page.tsx` and `web/src/components/admin/admin-mail-templates-page.tsx` against `docs/web-design-system.md` and `docs/web-admin-governance-flow.md`.
- Confirmed deterministic `loading`, `empty`, `error`, and ready states are visible, retry behavior is explicit, and operational safeguards (test target input + reset confirmation gate) remain understandable and actionable.
- Confirmed localized/session guard behavior for expired or unauthorized sessions stays consistent with admin auth flow.
- Fixed requirement-scoped DE copy consistency issues in `web/messages/de.json` to remove mixed-language UX terms (for example `read-only`, `Guardrails`, `Template-...`, `resetten`) from user-facing text while preserving technical identifiers (audit event names).
- Validation: `node -e "JSON.parse(require('fs').readFileSync('/home/sebas/git/shift-matching/web/messages/de.json','utf8')); console.log('JSON OK')"` passed; `npm --prefix /home/sebas/git/shift-matching/web run lint` passed.
Changes: `web/messages/de.json`, `/home/sebas/git/agents/requirements/deploy/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`

# Deploy Results
- Validation: Coolify deploy-readiness gates are green for this requirement scope and align with `README.md` deployment commands plus `docs/web-release-versioning-model.md` and `docs/web-quality-test-program.md` release gates.
- Checks:
  - `node /home/sebas/git/shift-matching/scripts/qa-gate.js` (pass)
  - `npm --prefix /home/sebas/git/shift-matching/web run lint` (pass)
  - `npm --prefix /home/sebas/git/shift-matching/web run build` (pass; existing non-blocking EN `MISSING_MESSAGE` logs remain baseline)
  - `npm --prefix /home/sebas/git/shift-matching/app run build` (pass)
  - `npm --prefix /home/sebas/git/shift-matching/app run test` (pass, `259` tests)
- Decision: pass; move to `released`.
- Changes: `/home/sebas/git/agents/requirements/deploy/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md` -> `/home/sebas/git/agents/requirements/released/REQ-WEB-ADMIN-MAIL-LIVE-OPERATIONS-AND-TEMPLATES.md`
